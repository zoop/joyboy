/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{588:function(xa,ta,h){h.r(ta);var ra=h(0),na=h(7),oa=h(3);xa=h(57);var ja=h(34),ka=h(14);h=function(){function fa(){this.init()}fa.prototype.init=function(){this.nna=!1;this.Hg=this.Vo=this.connection=null;this.Fw={};this.ga=this.mN=null};fa.prototype.MJa=function(x){for(var y=this,r=0;r<x.length;++r){var n=x[r];switch(n.at){case "create":this.Fw[n.author]||(this.Fw[n.author]=n.aName);this.yxa(n);break;case "modify":this.ga.Zr(n.xfdf).then(function(f){y.ga.Ib(f[0])});
break;case "delete":this.ga.Zr("<delete><id>"+n.aId+"</id></delete>")}}};fa.prototype.yxa=function(x){var y=this;this.ga.Zr(x.xfdf).then(function(r){r=r[0];r.authorId=x.author;y.ga.Ib(r);y.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};fa.prototype.Owa=function(x,y,r){this.Vo&&this.Vo(x,y,r)};fa.prototype.preloadAnnotations=function(x){this.addEventListener("webViewerServerAnnotationsEnabled",this.Owa.bind(this,x,"add",{imported:!1}),{once:!0})};fa.prototype.initiateCollaboration=function(x,
y,r){var n=this;if(x){n.Hg=y;n.ga=r.ma();r.addEventListener(na.h.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.vKa(x);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var a=JSON.parse(f.responseText);n.connection=exports.da.ILa(Object(ja.k)(n.Hg,"blackbox/"),"annot");n.mN=a.id;n.Fw[a.id]=a.user_name;n.ga.eX(a.id);n.connection.bPa(function(b){b.t&&b.t.startsWith("a_")&&b.data&&n.MJa(b.data)},function(){n.connection.send({t:"a_retrieve",
dId:x});n.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.Fw[a.id],n.mN])},function(){n.disableCollaboration()})}catch(b){Object(oa.g)(b.message)}});f.open("GET",Object(ja.k)(this.Hg,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();n.nna=!0;n.ga.Zba(function(a){return n.Fw[a.Author]||a.Author})}else Object(oa.g)("Document ID required for collaboration")};fa.prototype.disableCollaboration=function(){this.Vo&&(this.ga.removeEventListener(ka.a.Events.ANNOTATION_CHANGED,this.Vo),this.Vo=
null);this.connection&&this.connection.bu();this.ga&&this.ga.eX("Guest");this.init();this.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};fa.prototype.vKa=function(x){var y=this;this.Vo&&this.ga.removeEventListener(ka.a.Events.ANNOTATION_CHANGED,this.Vo);this.Vo=function(r,n,f){return Object(ra.b)(this,void 0,void 0,function(){var a,b,e,w,ba,ca,ia,z,ea;return Object(ra.d)(this,function(aa){switch(aa.label){case 0:if(f.imported)return[2];a={t:"a_"+n,dId:x,annots:[]};return[4,y.ga.S4()];case 1:b=
aa.aa();"delete"!==n&&(e=(new DOMParser).parseFromString(b,"text/xml"),w=new XMLSerializer);for(ba=0;ba<r.length;ba++)ca=r[ba],z=ia=void 0,"add"===n?(ia=e.querySelector('[name="'+ca.Id+'"]'),z=w.serializeToString(ia),ea=null,ca.InReplyTo&&(ea=y.ga.tg(ca.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:ca.Id,author:y.mN,aName:y.Fw[y.mN],parent:ea,xfdf:"<add>"+z+"</add>"})):"modify"===n?(ia=e.querySelector('[name="'+ca.Id+'"]'),z=w.serializeToString(ia),a.annots.push({at:"modify",aId:ca.Id,
xfdf:"<modify>"+z+"</modify>"})):"delete"===n&&a.annots.push({at:"delete",aId:ca.Id});0<a.annots.length&&y.connection.send(a);return[2]}})})}.bind(y);this.ga.addEventListener(ka.a.Events.ANNOTATION_CHANGED,this.Vo)};fa.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return fa}();Object(xa.a)(h);ta["default"]=h}}]);}).call(this || window)
